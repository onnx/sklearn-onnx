<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Supported scikit-learn Models" href="supported.html" /><link rel="prev" title="Convert a pipeline" href="pipeline.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.08.19 -->
        <title>Converters with options - sklearn-onnx 1.16.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">sklearn-onnx 1.16.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo_main.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">sklearn-onnx 1.16.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_tutorial.html">Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorial</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial_1_simple.html">The easy case</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of The easy case</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_abegin_convert_pipeline.html">Train and deploy a scikit-learn pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_bbegin_measure_time.html">Benchmark ONNX conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_cbegin_opset.html">What is the opset number?</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_dbegin_options.html">One model, many possible conversions with options</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_dbegin_options_zipmap.html">Choose appropriate output of a classifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_dbegin_options_list.html">Black list operators when converting</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_ebegin_float_double.html">Issues when switching to float</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_fbegin_investigate.html">Intermediate results and investigation</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gbegin_cst.html">Store arrays in one onnx graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gbegin_dataframe.html">Dataframe as an input</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gconverting.html">Modify the ONNX graph</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial_1-5_external.html">Using converters from other libraries</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Using converters from other libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gexternal_lightgbm.html">Convert a pipeline with a LightGBM classifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gexternal_lightgbm_reg.html">Convert a pipeline with a LightGBM regressor</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gexternal_xgboost.html">Convert a pipeline with a XGBoost model</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_gexternal_catboost.html">Convert a pipeline with a CatBoost classifier</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial_2_new_converter.html">A custom converter for a custom model</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of A custom converter for a custom model</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_icustom_converter.html">Implement a new converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_jcustom_syntax.html">Two ways to implement a converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_kcustom_converter_wrapper.html">Implement a new converter using other converters</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_lcustom_options.html">A new converter with options</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_mcustom_parser.html">Change the number of outputs by adding a parser</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial_4_advanced.html">Advanced scenarios</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Advanced scenarios</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_ngrams.html">Tricky issue when converting CountVectorizer or TfidfVectorizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_usparse_xgboost.html">TfIdf and sparse matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_woe_transformer.html">Converter for WOE</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial_2-5_extlib.html">Write converters for other libraries</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Write converters for other libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="auto_tutorial/plot_wext_pyod_forest.html">Converter for pyod.models.iforest.IForest</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_summary.html">API Summary</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="auto_examples/index.html">Gallery of examples</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Gallery of examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_metadata.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_backend.html">ONNX Runtime Backend for ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_pipeline.html">Draw a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_logging.html">Logging, verbose</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_convert_decision_function.html">Probabilities or raw scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_convert_model.html">Train, convert and predict a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_investigate_pipeline.html">Investigate a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_benchmark_cdist.html">Compare CDist with scipy</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_convert_zipmap.html">Probabilities as a vector or as a ZipMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_pipeline_lightgbm.html">Convert a pipeline with a LightGbm model</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_black_op.html">Convert a model with a reduced list of operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_nmf.html">Custom Operator for NMF Decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_cast_transformer.html">Discrepencies with StandardScaler</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_benchmark_pipeline.html">Benchmark a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_pipeline_xgboost.html">Convert a pipeline with a XGBoost model</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_gpr.html">Discrepencies with GaussianProcessorRegressor: use of double</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_errors_onnxruntime.html">Errors with onnxruntime</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_onnx_operators.html">Play with ONNX operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_convert_syntax.html">Different ways to convert a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_complex_pipeline.html">Convert a pipeline with ColumnTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_tfidfvectorizer.html">TfIdfVectorizer with ONNX</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_intermediate_outputs.html">Walk through intermediate outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_custom_parser_alternative.html">When a custom model is neither a classifier nor a regressor (alternative)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_custom_parser.html">When a custom model is neither a classifier nor a regressor</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_custom_model.html">Write your own converter for your own model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Convert a pipeline</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Converters with options</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported.html">Supported scikit-learn Models</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="converters-with-options">
<span id="l-conv-options"></span><h1>Converters with options<a class="headerlink" href="#converters-with-options" title="Permalink to this heading">#</a></h1>
<p>Most of the converters always produce the same converted model
which computes the same outputs as the original model.
However, some of them do not and the user may need to alter the
conversion by giving additional information to the converter through
functions <a class="reference internal" href="api_summary.html#skl2onnx.convert_sklearn" title="skl2onnx.convert_sklearn"><code class="xref py py-func docutils literal notranslate"><span class="pre">convert_sklearn</span></code></a>
or <a class="reference internal" href="api_summary.html#skl2onnx.to_onnx" title="skl2onnx.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a>.
Every option ends up creating a different ONNX graph.
Below is the list of models which enable this mechanism.</p>
<section id="gaussianprocessregressor-nearestneighbors">
<h2>GaussianProcessRegressor, NearestNeighbors<a class="headerlink" href="#gaussianprocessregressor-nearestneighbors" title="Permalink to this heading">#</a></h2>
<p id="index-0">Both models require to compure pairwise distances.
Function <code class="xref py py-func docutils literal notranslate"><span class="pre">onnx_cdist</span></code>
produces this part of the graph but there exist two options.
The first one is using <em>Scan</em> operator, the second one is
using a dedicated operator called <em>CDist</em> which is not part
of the regular ONNX operator until issue
<a class="reference external" href="https://github.com/onnx/onnx/issues/2442">2442</a>
is addressed. By default, <em>Scan</em> is used, <em>CDist</em> can be used
by giving:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="n">GaussianProcessRegressor</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="s1">&#39;cdist&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Previous line enables the optimization for every
model <em>GaussianProcessRegressor</em> but it can be done
only for one model by using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">model</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;optim&#39;</span><span class="p">:</span> <span class="s1">&#39;cdist&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="tfidfvectorizer-countvectorizer">
<h2>TfidfVectorizer, CountVectorizer<a class="headerlink" href="#tfidfvectorizer-countvectorizer" title="Permalink to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skl2onnx.operator_converters.text_vectoriser.convert_sklearn_text_vectorizer">
<span class="sig-prename descclassname"><span class="pre">skl2onnx.operator_converters.text_vectoriser.</span></span><span class="sig-name descname"><span class="pre">convert_sklearn_text_vectorizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="api_summary.html#skl2onnx.common._topology.Scope" title="skl2onnx.common._topology.Scope"><span class="pre">Scope</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">operator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="api_summary.html#skl2onnx.common._topology.Operator" title="skl2onnx.common._topology.Operator"><span class="pre">Operator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="api_summary.html#skl2onnx.common._container.ModelComponentContainer" title="skl2onnx.common._container.ModelComponentContainer"><span class="pre">ModelComponentContainer</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/skl2onnx/operator_converters/text_vectoriser.html#convert_sklearn_text_vectorizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#skl2onnx.operator_converters.text_vectoriser.convert_sklearn_text_vectorizer" title="Permalink to this definition">#</a></dt>
<dd><p>Converters for class
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html">TfidfVectorizer</a>.
The current implementation is a work in progress and the ONNX version
does not produce the exact same results. The converter lets the user
change some of its parameters.</p>
<section id="additional-options">
<h3>Additional options<a class="headerlink" href="#additional-options" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt>tokenexp: string</dt><dd><p>The default will change to true in version 1.6.0.
The tokenizer splits into words using this regular
expression or the regular expression specified by
<em>scikit-learn</em> is the value is an empty string.
See also note below.
Default value: None</p>
</dd>
<dt>separators: list of separators</dt><dd><p>These separators are used to split a string into words.
Options <em>separators</em> is ignore if options <em>tokenexp</em> is not None.
Default value: <code class="docutils literal notranslate"><span class="pre">['</span> <span class="pre">',</span> <span class="pre">'[.]',</span> <span class="pre">'\\?',</span> <span class="pre">',',</span> <span class="pre">';',</span> <span class="pre">':',</span> <span class="pre">'\\!']</span></code>.</p>
</dd>
<dt>locale:</dt><dd><p>The locale is not mentioned in scikit-object. This option can be
used to change the value for parameter <cite>locale</cite> of ONNX operator
<cite>StringNormalizer</cite>.</p>
</dd>
</dl>
<p>Example (from <a class="reference internal" href="auto_examples/plot_tfidfvectorizer.html#l-example-tfidfvectorizer"><span class="std std-ref">TfIdfVectorizer with ONNX</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">seps</span> <span class="o">=</span> <span class="p">{</span><span class="n">TfidfVectorizer</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;separators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;[.]&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">?&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">)&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">[&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">]}}</span>
<span class="n">model_onnx</span> <span class="o">=</span> <span class="n">convert_sklearn</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;tfidf&quot;</span><span class="p">,</span>
                             <span class="n">initial_types</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">StringTensorType</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))],</span>
                             <span class="n">options</span><span class="o">=</span><span class="n">seps</span><span class="p">)</span>
</pre></div>
</div>
<p>The default regular expression of the tokenizer is <code class="docutils literal notranslate"><span class="pre">(?u)\\b\\w\\w+\\b</span></code>
(see <a class="reference external" href="https://docs.python.org/3/library/re.html">re</a>).
This expression may not supported by the library handling the backend.
<a class="reference external" href="https://github.com/Microsoft/onnxruntime">onnxruntime</a> uses
<a class="reference external" href="https://github.com/google/re2">re2</a>. You may need to switch
to a custom tokenizer based on
<a class="reference external" href="https://pypi.org/project/re2/">python wrapper for re2</a>
or its sources <a class="reference external" href="https://github.com/facebook/pyre2">pyre2</a>
(<a class="reference external" href="https://github.com/google/re2/blob/master/doc/syntax.txt">syntax</a>).
If the regular expression is not specified and if
the instance of TfidfVectorizer is using the default
pattern <code class="docutils literal notranslate"><span class="pre">(?u)\\b\\w\\w+\\b</span></code>, it is replaced by
<code class="docutils literal notranslate"><span class="pre">[a-zA-Z0-9_]+</span></code>. Any other case has to be
manually handled.</p>
<p>Regular expression <code class="docutils literal notranslate"><span class="pre">[^\\\\n]</span></code> is used to split
a sentance into character (and not works) if <code class="docutils literal notranslate"><span class="pre">analyser=='char'</span></code>.
The mode <code class="docutils literal notranslate"><span class="pre">analyser=='char_wb'</span></code> is not implemented.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6: </span>Parameters have been renamed: <em>sep</em> into <em>separators</em>,
<em>regex</em> into <em>tokenexp</em>.</p>
</div>
</section>
</dd></dl>

</section>
<hr class="docutils" />
<section id="classifiers">
<h2>Classifiers<a class="headerlink" href="#classifiers" title="Permalink to this heading">#</a></h2>
<p>Converters for classifiers implement multiple options.</p>
<section id="zipmap">
<h3>ZipMap<a class="headerlink" href="#zipmap" title="Permalink to this heading">#</a></h3>
<p>The operator <em>ZipMap</em> produces a list of dictionaries.
It repeats class names or ids but that’s not necessary
(see issue <a class="reference external" href="https://github.com/onnx/onnx/issues/2149">2149</a>).
By default, ZipMap operator is added, it can be deactivated by using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
</pre></div>
</div>
<p>It is implemented by PR <a class="reference external" href="https://github.com/onnx/sklearn-onnx/pull/327">327</a>.</p>
</section>
<section id="class-information">
<h3>Class information<a class="headerlink" href="#class-information" title="Permalink to this heading">#</a></h3>
<p>Class information is usually repeated in the ONNX operator
which classifies and the output of the ZipMap operator
(see issue <a class="reference external" href="https://github.com/onnx/onnx/issues/2149">2149</a>).
The following option can remove string information and class ids
in the ONNX operator to get smaller models.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;nocl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
</pre></div>
</div>
<p>Classes are replaced by integers from 0 to the number of classes.</p>
</section>
<section id="raw-scores">
<h3>Raw scores<a class="headerlink" href="#raw-scores" title="Permalink to this heading">#</a></h3>
<p>Almost all classifiers are converted in order to get probabilities
and not raw scores. That’s the default behaviour. It can be deactivated
by using option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;raw_scores&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
</pre></div>
</div>
<p>It is implemented by PR <a class="reference external" href="https://github.com/onnx/sklearn-onnx/pull/308">308</a>.</p>
</section>
</section>
<section id="pickability-and-pipeline">
<h2>Pickability and Pipeline<a class="headerlink" href="#pickability-and-pipeline" title="Permalink to this heading">#</a></h2>
<p>The proposed way to specify options is not always pickable.
Function <code class="docutils literal notranslate"><span class="pre">id(model)</span></code> depends on the execution and map an option
to one class may be not enough to customize the conversion.
However, it is possible to specify an option the same way
parameters are referenced in a <em>scikit-learn</em> pipeline
with method <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline.get_params">get_params</a>.
Following syntax are supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())])</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
</pre></div>
</div>
<p>Or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
<p>Options applied to one model, not a pipeline as the converter
replaces the pipeline structure by a single onnx graph.
Following that rule, option <em>zipmap</em> would not have any impact
if applied to a pipeline and to the last step of the pipeline.
However, because there is no ambiguity about what the conversion
should be, for options <em>zipmap</em> and <em>nocl</em>, the following
options would have the same effect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())])</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="supported.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Supported scikit-learn Models</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="pipeline.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Convert a pipeline</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2023, Microsoft
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Converters with options</a><ul>
<li><a class="reference internal" href="#gaussianprocessregressor-nearestneighbors">GaussianProcessRegressor, NearestNeighbors</a></li>
<li><a class="reference internal" href="#tfidfvectorizer-countvectorizer">TfidfVectorizer, CountVectorizer</a><ul>
<li><a class="reference internal" href="#skl2onnx.operator_converters.text_vectoriser.convert_sklearn_text_vectorizer"><code class="docutils literal notranslate"><span class="pre">convert_sklearn_text_vectorizer()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#classifiers">Classifiers</a><ul>
<li><a class="reference internal" href="#zipmap">ZipMap</a></li>
<li><a class="reference internal" href="#class-information">Class information</a></li>
<li><a class="reference internal" href="#raw-scores">Raw scores</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pickability-and-pipeline">Pickability and Pipeline</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=9a8fb93a"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>