
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Introduction &#8212; sklearn-onnx 1.11 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="index_tutorial.html" />
    <link rel="prev" title="sklearn-onnx: Convert your scikit-learn model into ONNX" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="index.html">
  <img src="_static/logo_main.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Introduction
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="index_tutorial.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api_summary.html">
  API Summary
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="auto_examples/index.html">
  Gallery of examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="pipeline.html">
  Convert a pipeline
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="parameterized.html">
  Converters with options
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="supported.html">
  Supported scikit-learn Models
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-train-a-model-using-your-favorite-framework">
     Step 1: Train a model using your favorite framework
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-convert-or-export-the-model-into-onnx-format">
     Step 2: Convert or export the model into ONNX format
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-load-and-run-the-model-using-onnx-runtime">
     Step 3: Load and run the model using ONNX Runtime
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-sklearn-to-onnx-initial-types">
   convert_sklearn, to_onnx, initial_types
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#quick-start" id="id1">Quick start</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1-train-a-model-using-your-favorite-framework" id="id2">Step 1: Train a model using your favorite framework</a></p></li>
<li><p><a class="reference internal" href="#step-2-convert-or-export-the-model-into-onnx-format" id="id3">Step 2: Convert or export the model into ONNX format</a></p></li>
<li><p><a class="reference internal" href="#step-3-load-and-run-the-model-using-onnx-runtime" id="id4">Step 3: Load and run the model using ONNX Runtime</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#convert-sklearn-to-onnx-initial-types" id="id5">convert_sklearn, to_onnx, initial_types</a></p></li>
</ul>
</div>
<div class="section" id="quick-start">
<h2><a class="toc-backref" href="#id1">Quick start</a><a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p><em>ONNX Runtime</em> provides an easy way to run
machine learned models with high performance on CPU or GPU
without dependencies on the training framework.
Machine learning frameworks are usually optimized for
batch training rather than for prediction, which is a
more common scenario in applications, sites, and services.
At a high level, you can:</p>
<ol class="arabic simple">
<li><p>Train a model using your favorite framework.</p></li>
<li><p>Convert or export the model into ONNX format.
See <a class="reference external" href="https://github.com/onnx/tutorials">ONNX Tutorials</a>
for more details.</p></li>
<li><p>Load and run the model using <em>ONNX Runtime</em>.</p></li>
</ol>
<p>In this tutorial, we will briefly create a
pipeline with <em>scikit-learn</em>, convert it into
ONNX format and run the first predictions.</p>
<div class="section" id="step-1-train-a-model-using-your-favorite-framework">
<h3><a class="toc-backref" href="#id2">Step 1: Train a model using your favorite framework</a><a class="headerlink" href="#step-1-train-a-model-using-your-favorite-framework" title="Permalink to this headline">¶</a></h3>
<p>We’ll use the famous Iris datasets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">clr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">clr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-convert-or-export-the-model-into-onnx-format">
<h3><a class="toc-backref" href="#id3">Step 2: Convert or export the model into ONNX format</a><a class="headerlink" href="#step-2-convert-or-export-the-model-into-onnx-format" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/onnx/onnx">ONNX</a> is a format to describe
the machine learned model.
It defines a set of commonly used operators to compose models.
There are <a class="reference external" href="https://github.com/onnx/tutorials">tools</a>
to convert other model formats into ONNX. Here we will use
<a class="reference external" href="https://github.com/onnx/onnxmltools">ONNXMLTools</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skl2onnx</span> <span class="kn">import</span> <span class="n">convert_sklearn</span>
<span class="kn">from</span> <span class="nn">skl2onnx.common.data_types</span> <span class="kn">import</span> <span class="n">FloatTensorType</span>

<span class="n">initial_type</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;float_input&#39;</span><span class="p">,</span> <span class="n">FloatTensorType</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))]</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">convert_sklearn</span><span class="p">(</span><span class="n">clr</span><span class="p">,</span> <span class="n">initial_types</span><span class="o">=</span><span class="n">initial_type</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;logreg_iris.onnx&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-load-and-run-the-model-using-onnx-runtime">
<h3><a class="toc-backref" href="#id4">Step 3: Load and run the model using ONNX Runtime</a><a class="headerlink" href="#step-3-load-and-run-the-model-using-onnx-runtime" title="Permalink to this headline">¶</a></h3>
<p>We will use <em>ONNX Runtime</em> to compute the predictions
for this machine learning model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">onnxruntime</span> <span class="k">as</span> <span class="nn">rt</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="s2">&quot;logreg_iris.onnx&quot;</span><span class="p">)</span>
<span class="n">input_name</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">label_name</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

<span class="n">pred_onx</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">label_name</span><span class="p">],</span> <span class="p">{</span><span class="n">input_name</span><span class="p">:</span> <span class="n">X_test</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="convert-sklearn-to-onnx-initial-types">
<span id="index-0"></span><h2><a class="toc-backref" href="#id5">convert_sklearn, to_onnx, initial_types</a><a class="headerlink" href="#convert-sklearn-to-onnx-initial-types" title="Permalink to this headline">¶</a></h2>
<p>The module implements two functions:
<a class="reference internal" href="api_summary.html#skl2onnx.convert_sklearn" title="skl2onnx.convert_sklearn"><code class="xref py py-func docutils literal notranslate"><span class="pre">convert_sklearn</span></code></a> and
<a class="reference internal" href="api_summary.html#skl2onnx.to_onnx" title="skl2onnx.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a>. The first one
was used in the previous examples, it requires two
mandatory arguments:</p>
<ul class="simple">
<li><p>a <em>scikit-learn</em> model or a pipeline</p></li>
<li><p>initial types</p></li>
</ul>
<p><em>scikit-learn</em> does not store information about
the training dataset. It is not always possible to retrieve
the number of features or their types. That’s why the
function needs another argument called <em>initial_types</em>.
In many cases, the training datasets is a numerical matrix
<em>X_train</em>. Then it becomes
<code class="docutils literal notranslate"><span class="pre">initial_type=[('X',</span> <span class="pre">FloatTensorType([None,</span> <span class="pre">X_train.shape[1]]))]</span></code>.
<em>X</em> is the name of this unique input, the second term indicates the
type and shape. The shape is <code class="docutils literal notranslate"><span class="pre">[None,</span> <span class="pre">X_train.shape[1]]</span></code>,
the first dimension is the number of rows followed by the
number of features. The number of rows is undefined as the
the number of requested predictions is unknown at the time
the model is converted. The number of features is usually known.
Let’s assume now the input is a string column followed by
a matrix, then initial types would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">initial_type</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">StringTensorType</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">])),</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">FloatTensorType</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Function <a class="reference internal" href="api_summary.html#skl2onnx.to_onnx" title="skl2onnx.to_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_onnx</span></code></a> was implemented
after discussions with the core developers of <em>scikit-learn</em>.
It also contains a mechanism to infer the proper type based on
one row of the training datasets. Then, the following code
<code class="docutils literal notranslate"><span class="pre">convert_sklearn(clr,</span> <span class="pre">initial_types=[('X',</span> <span class="pre">FloatTensorType([None,</span> <span class="pre">4]))])</span></code>
is usually rewritten into <code class="docutils literal notranslate"><span class="pre">to_onnx(clr,</span> <span class="pre">X_train[:1])</span></code> where
<em>X_train</em> is the training dataset, it can be a matrix or a
dataframe. The input name is <code class="docutils literal notranslate"><span class="pre">'X'</span></code> by default unless <em>X_train</em>
is a dataframe. In that case, the column names are used
as input names.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">sklearn-onnx: Convert your scikit-learn model into ONNX</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="index_tutorial.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2018-2022, Microsoft.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>